<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login MerqNet</title>
</head>
<body>
  <h2>Iniciar sesi√≥n en MerqNet</h2>
  <form id="loginForm">
    <input type="email" id="email" placeholder="Email" required><br><br>
    <input type="password" id="password" placeholder="Password" required><br><br>
    <button type="submit">Iniciar Sesi√≥n</button>
  </form>

  <pre id="response"></pre>

  <script>
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const responseBox = document.getElementById('response');
      responseBox.textContent = '‚è≥ Enviando...';

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      try {
        const res = await fetch('http://localhost:5000/api/users/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await res.json();

        if (res.ok) {
          // Guardar sesi√≥n en localStorage
          localStorage.setItem("userId", data.user._id);
          localStorage.setItem("token", data.token);

          // Mostrar en consola para debug
          console.log("‚úÖ Login exitoso:", data);
          console.log("üîê userId guardado:", data.user._id);
          console.log("üîê token guardado:", data.token);

          // Redirigir a p√°gina de m√©todos de pago
          window.location.href = "add-method.html";
        } else {
          responseBox.textContent = "‚ùå Error: " + (data.message || "Error desconocido");
        }

      } catch (err) {
        responseBox.textContent = '‚ùå Error de conexi√≥n: ' + err.message;
      }
    });
  </script>
</body>
</html>
